<html>

<head>
    <title>Jake Bot</title>
</head>

<body>
    X:
    <input type="text" id="x" /> Y:
    <input type="text" id="y" />

    <button type="button" onclick="wsavc.playStream()">Start Video</button>
    <button type="button" onclick="wsavc.stopStream()">Stop Video</button>
    <button type="button" onclick="wsavc.disconnect()">Disconnect</button>
    <br/>

    <!-- provide WSAvcPlayer -->
    <script type="text/javascript" src="http-live-player.js">;</script>
    <script type="text/javascript">

        var canvas = document.createElement("canvas");
        document.body.appendChild(canvas);

        // Create h264 player
        var uri = "ws://" + document.location.host.replace(":8000",":8080");
        var wsavc = new WSAvcPlayer(canvas, "webgl", 1, 35);
        wsavc.connect(uri);

        //expose instance for button callbacks
        window.wsavc = wsavc;

    </script>


    <script>
        var x = 0;
        var y = 0;
        var scale = 100;

        document.getElementById("x").value = x;
        document.getElementById("y").value = y;

        var addToVar = function (target, value) {
            var tmpx = x;
            var tmpy = y;

            if (target) {
                y += value;
            }
            else {
                x += value;
            }

            if (Math.sqrt((x * x) + (y * y)) > 4094) {
                x = tmpx;
                y = tmpy;
            }
        }

        var sendValues = function (x, y) {
            var url = "/setSpeed/" + x + "/" + y;
            var xhr = new XMLHttpRequest();
            xhr.open("PUT", url, true);
            xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
            xhr.send();
        }

        window.addEventListener('keydown', function (event) {
            switch (event.keyCode) {
                case 37: // Left
                    addToVar(1, -1 * scale);
                    break;

                case 38: // Up
                    addToVar(0, scale);
                    break;

                case 39: // Right
                    addToVar(1, scale);
                    break;

                case 40: // Down
                    addToVar(0, -1 * scale);
                    break;
                case 32: //space
                    x = 0;
                    y = 0;
                    break;
                default:
                    console.log(event.keyCode);
                    break;
            }
            document.getElementById("x").value = x;
            document.getElementById("y").value = y;
            sendValues(x, y);

        }, false);
    </script>
</body>
</html>